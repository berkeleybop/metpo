# Pre-commit Hooks Setup Guide

## Quick Start

```bash
# Install pre-commit hooks
uv sync --extra dev
uv run pre-commit install

# Run on all files (first time)
uv run pre-commit run --all-files

# Hooks will now run automatically on git commit
```

## What Gets Checked

### Automated Fixes (Applied Automatically)
- **Trailing whitespace**: Removed from all files
- **End of file**: Ensures files end with newline
- **Mixed line endings**: Normalizes to LF
- **Ruff linter**: Auto-fixes code style issues
- **Ruff formatter**: Formats code consistently
- **Import sorting**: Organizes imports

### Blocking Checks (Must Fix Manually)
- **Large files**: Files >10MB rejected
- **YAML/JSON/TOML**: Syntax validation
- **Merge conflicts**: Detects conflict markers
- **Debug statements**: Catches leftover breakpoint()
- **MyPy**: Type checking (informational)

## Manual Commands

```bash
# Run hooks on staged files only
uv run pre-commit run

# Run hooks on all files
uv run pre-commit run --all-files

# Run specific hook
uv run pre-commit run ruff --all-files
uv run pre-commit run mypy --all-files

# Update hook versions
uv run pre-commit autoupdate

# Temporarily skip hooks
git commit --no-verify -m "message"
```

## Ruff Configuration

Config file: `ruff.toml`

**Enabled rule categories:**
- `E/W`: pycodestyle errors and warnings
- `F`: pyflakes (undefined names, unused imports)
- `I`: isort (import sorting)
- `N`: PEP-8 naming conventions
- `UP`: pyupgrade (modern Python syntax)
- `B`: bugbear (common bugs and design problems)
- `C4`: comprehensions (list/dict/set comprehensions)
- `PLR`: pylint refactoring rules
- `RUF`: ruff-specific rules

**Key settings:**
- Line length: 100 characters
- Target: Python 3.11+
- Double quotes for strings
- Allow print() in script files

## MyPy Configuration

**Settings:**
- Ignore missing imports (for optional dependencies)
- No strict optional checking
- Excludes: notebooks/, docs/, large/, data/

**Type stubs installed:**
- `types-PyYAML`
- `types-requests`

## Excluded Directories

The following are excluded from all checks:
- `.venv/`, `.git/`, `__pycache__/`
- `src/ontology/` (ODK-generated)
- `notebooks/` (Jupyter notebooks)
- `large/`, `downloads/`, `local/` (data directories)
- `*.owl`, `*.obo`, `*.ttl` (ontology files)
- `*.tsv`, `*.csv` (data files)

## Troubleshooting

### Hooks fail on first run
This is normal! Pre-commit will auto-fix many issues. Run `git add` again after fixes.

### Ruff changes too much
Review changes: `git diff`
If needed, add `# noqa: CODE` to ignore specific lines

### MyPy fails
MyPy is set to `continue-on-error` in CI. Fix gradually or add type: ignore comments.

### Uninstall hooks
```bash
uv run pre-commit uninstall
```

## CI Integration

GitHub Actions runs the same checks in `.github/workflows/python-quality.yml`:
- Ruff linting and formatting
- MyPy type checking
- CLI smoke tests

Pushes to `main` and all PRs trigger these checks automatically.
