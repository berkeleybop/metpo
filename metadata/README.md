# Metadata Collections

This directory contains JSON files that can be imported into MongoDB to create metadata collections.

## Design Philosophy

**Commit data, not code for simple collections**
- Simple metadata collections (like `files`) are stored as JSON and imported via `mongoimport`
- Complex derived collections (like `field_mappings`) are generated by tools but JSON is also committed

## Files

### BactoTraits Metadata

#### `bactotraits_files.json`
Simple metadata about the two BactoTraits file versions.

**Import:**
```bash
mongoimport --db bactotraits --collection files \
  --file metadata/bactotraits_files.json \
  --jsonArray --drop
```

**Contents:** 2 documents describing provider and kg-microbe files

#### `bactotraits_field_mappings.json`
Complex mapping of field names across provider, kg-microbe, and MongoDB versions.

**Generate and import:**
```bash
make metadata/bactotraits_field_mappings.json
```

**Or manually:**
```bash
uv run create-bactotraits-field-mappings \
  --provider-file local/bactotraits/BactoTraits_databaseV2_Jun2022.csv \
  --kg-microbe-file local/bactotraits/BactoTraits.tsv \
  --output-json metadata/bactotraits_field_mappings.json \
  --db-name bactotraits \
  --collection-name field_mappings
```

**Contents:** 106 documents mapping field name transformations

---

### Madin Metadata

#### `madin_files.json`
Simple metadata about Madin file versions (provider and kg-microbe).

**Import:**
```bash
mongoimport --db madin --collection files \
  --file metadata/madin_files.json \
  --jsonArray --drop
```

**Contents:** 2 documents describing the files used in the Madin workflow

---

## Why This Approach?

### Simple Collections (files)
- **No code needed** - Just JSON that gets imported
- **Version controlled** - Changes tracked in git
- **Easy to edit** - Just update JSON and re-import
- **No dependencies** - Works with just mongoimport

### Complex Collections (field_mappings)
- **Generated by tool** - Reads actual file headers, applies transformations
- **Reproducible** - Can regenerate from source files
- **JSON committed** - Provides documentation and backup
- **Makefile target** - `make metadata/bactotraits_field_mappings.json`

## Collection Status

| Database | Collection | Source | Method |
|----------|-----------|---------|--------|
| bactotraits | files | `bactotraits_files.json` | mongoimport |
| bactotraits | field_mappings | Generated + JSON | make target |
| madin | files | `madin_files.json` | mongoimport |

## Workflow Integration

These metadata collections are **optional** but useful for:
- Documenting file provenance
- Understanding field name transformations
- Tracking data pipeline versions

They are **not required** for the main data analysis workflows to function.
